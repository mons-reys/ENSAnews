<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- font awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- costume css -->
    <link rel="stylesheet" href="/styles.css">
    <title>ENSAnews</title>
</head>
<body>
   <header>
        <%- include ('../partials/header.ejs') %>
   </header>
   <aside>
        <%- include('../partials/slider.ejs') %> 
   </aside>
   <section>
       <div class="container">
        <%- include('./Adminpartials/newBlogTrigger.ejs') %> 
            <h1>All Blogs</h1>
            <!-- post -->
            <div class="row">
                <%if(blogs.length > 0) { %>
                    <% blogs.forEach(blog => { %>   
                        <div class="col s12 l6">
                            <div class="card ">
                                <div class="card-image">
                                    <img src="images/<%= blog.img  %>" alt="">
                                    
                                    <a class="btn-floating green tooltipped handling-btn " data-position="left" data-tooltip="edit">
                                        <i class="material-icons">edit</i>
                                    </a>
                                    <a class="btn-floating red  tooltipped handling-btn delete" data-doc="<%= blog._id %>"  data-position="right" data-tooltip="delete">
                                        <i class="material-icons">delete</i>
                                    </a>
                                </div>
                                <div class="card-content blogCardConten">
                                    <span class="card-title"><%= blog.title %></span>
                                    <p><%= blog.snippet %></p>
                                </div>
                                <div class="card-action">
                                    <a href="/admin/blog/details/<%= blog._id%> " class="indigo-text">more details <span><i class="material-icons right">arrow_forward</i></span></a>
                                </div>
                            </div>
                        </div>
                    <% }); %> 
                <% } else { %>  
                    <p>no blogs found :'(</p> 
                <% } %>  
                <div class="col s12 center">
                    <ul class="pagination ">
                        <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                        <li class="active indigo lighten-1"><a href="#!">1</a></li>
                        <li class="waves-effect "><a href="#!">2</a></li>
                        <li class="waves-effect"><a href="#!">3</a></li>
                        <li class="waves-effect"><a href="#!">4</a></li>
                        <li class="waves-effect"><a href="#!">5</a></li>
                        <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
                      </ul>
                </div>
            </div>
       </div>
    </section>
       

   <footer class="page-footer grey darken-3">
        <%- include ('../partials/footer.ejs') %>
   </footer>
<!-- jquey -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<!-- sidenav and nav script  -->
<script>
    $(document).ready(function(){
        $('.sidenav').sidenav();
        $('.slider').slider();
        $('.tooltipped').tooltip();
        $('.modal').modal();
        $('select').formSelect();
    });
</script>  
<!-- costume scripts -->
<script>
    //delete blog 
   const trashcans = document.querySelectorAll('a.delete');
   trashcans.forEach(trashcan => {
        if(trashcan){
        trashcan.addEventListener('click', e => {
            const endpoint = `/admin/blog/details/${trashcan.dataset.doc}`;

            fetch(endpoint, {
                method: 'DELETE'
            })
            .then(response => {
                return response.json();
            })
            .then(data => window.location.href =  data.redirect)
            .catch(err => console.log(err))
        })
    }
   })
</script>
</body>
</html>